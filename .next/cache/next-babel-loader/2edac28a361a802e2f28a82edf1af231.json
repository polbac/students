{"ast":null,"code":"import { createConnection } from 'typeorm';\nimport { Country } from '../database/entity/Country';\nimport(\"reflect-metadata\");\n\nrequire('dotenv').config();\n\nexport function makeConnection() {\n  return new Promise(async (resolve, reject) => {\n    try {\n      global.connection = await createConnection({\n        type: process.env.DB_TYPE,\n        host: process.env.DB_HOST,\n        port: process.env.DB_PORT,\n        username: process.env.DB_USERNAME,\n        password: process.env.DB_PASSWORD,\n        database: process.env.DB_DATABASE,\n        entities: [Country]\n      });\n      resolve();\n    } catch (err) {\n      reject(err);\n    }\n  });\n}\nexport default (async () => {\n  console.log('1', global.connection);\n\n  if (!global.connection) {\n    global.connection = await makeConnection();\n  }\n\n  console.log('2', global.connection);\n  return global.connection;\n});","map":{"version":3,"sources":["/Users/TROCAUSER/dev/students/connection/index.ts"],"names":["createConnection","Country","require","config","makeConnection","Promise","resolve","reject","global","connection","type","process","env","DB_TYPE","host","DB_HOST","port","DB_PORT","username","DB_USERNAME","password","DB_PASSWORD","database","DB_DATABASE","entities","err","console","log"],"mappings":"AAAA,SAASA,gBAAT,QAAgE,SAAhE;AACA,SAASC,OAAT,QAAwB,4BAAxB;AACA,OAAQ,kBAAR;;AAEAC,OAAO,CAAC,QAAD,CAAP,CAAkBC,MAAlB;;AAEA,OAAO,SAASC,cAAT,GAA+C;AAClD,SAAO,IAAIC,OAAJ,CAAY,OAAOC,OAAP,EAAgBC,MAAhB,KAA2B;AAC1C,QAAI;AACCC,MAAAA,MAAD,CAAgBC,UAAhB,GAA6B,MAAMT,gBAAgB,CAAC;AAChDU,QAAAA,IAAI,EAAEC,OAAO,CAACC,GAAR,CAAYC,OAD8B;AAEhDC,QAAAA,IAAI,EAAEH,OAAO,CAACC,GAAR,CAAYG,OAF8B;AAGhDC,QAAAA,IAAI,EAAEL,OAAO,CAACC,GAAR,CAAYK,OAH8B;AAIhDC,QAAAA,QAAQ,EAAEP,OAAO,CAACC,GAAR,CAAYO,WAJ0B;AAKhDC,QAAAA,QAAQ,EAAET,OAAO,CAACC,GAAR,CAAYS,WAL0B;AAMhDC,QAAAA,QAAQ,EAAEX,OAAO,CAACC,GAAR,CAAYW,WAN0B;AAOhDC,QAAAA,QAAQ,EAAE,CAAEvB,OAAF;AAPsC,OAAD,CAAnD;AASAK,MAAAA,OAAO;AACV,KAXD,CAWE,OAAMmB,GAAN,EAAW;AACTlB,MAAAA,MAAM,CAACkB,GAAD,CAAN;AACH;AACJ,GAfM,CAAP;AAgBH;AAED,gBAAe,YAAiC;AAC5CC,EAAAA,OAAO,CAACC,GAAR,CAAY,GAAZ,EAAiBnB,MAAD,CAAgBC,UAAhC;;AACA,MAAG,CAAED,MAAD,CAAgBC,UAApB,EAAgC;AAC3BD,IAAAA,MAAD,CAAgBC,UAAhB,GAA6B,MAAML,cAAc,EAAjD;AACH;;AACDsB,EAAAA,OAAO,CAACC,GAAR,CAAY,GAAZ,EAAiBnB,MAAD,CAAgBC,UAAhC;AACA,SAAQD,MAAD,CAAgBC,UAAvB;AACH,CAPD","sourcesContent":["import { createConnection, ConnectionOptions, Connection } from 'typeorm'\nimport { Country } from '../database/entity/Country'\nimport (\"reflect-metadata\")\n\nrequire('dotenv').config()\n\nexport function makeConnection(): Promise<Connection> {\n    return new Promise(async (resolve, reject) => {\n        try {\n            (global as any).connection = await createConnection({\n                type: process.env.DB_TYPE,\n                host: process.env.DB_HOST,\n                port: process.env.DB_PORT,\n                username: process.env.DB_USERNAME,\n                password: process.env.DB_PASSWORD,\n                database: process.env.DB_DATABASE,\n                entities: [ Country ],\n            } as ConnectionOptions)\n            resolve()\n        } catch(err) {\n            reject(err)\n        }\n    })\n}\n\nexport default async (): Promise<Connection> => {\n    console.log('1',(global as any).connection)\n    if(!(global as any).connection) {\n        (global as any).connection = await makeConnection()\n    }\n    console.log('2',(global as any).connection)\n    return (global as any).connection\n} "]},"metadata":{},"sourceType":"module"}